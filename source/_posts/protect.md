---
title: linux pwn中的保护
date: 2023-01-02 00:00:01
categories: 
- pwn
tags: 
- pwn
---
安全是在攻防之中进步的，有了对漏洞的利用之后，就会有该漏洞的防护。

在pwn的过程中，通过checksec命令查看保护即可以知道什么方法在这次利用不太好使用中，以及在利用过程中要注意绕过什么保护。

linux中常见的保护大概有5种，分别为：

1. NX
2. Canary
3. PIE/ASLR
4. FORTIFY
5. RELRO
<!--more-->

## NX

NX保护主要用于防护**shellcode** 的攻击。通过将数据（栈、堆）所在的内存页标注为**不可执行**，防止程序在溢出后在该内存页上执行写入的shellcode。当程序试图在数据页上执行指令时，该指令会无法执行，并且CPU会抛出异常。

## Canary

Canary保护主要用于防护**栈溢出**的攻击。在函数执行前在栈中插入一段canary值，函数返回时验证canary的值是否一致来判断是否发生栈溢出。如果canary被修改，则程序停止运行，防止栈溢出覆盖函数返回地址。在push ebp(或rbp)后就将canary push入栈，因此如果要覆盖函数返回地址必须要先覆盖在其之前的ebp(或rbp)和canary。

## PIE/ASLR

PIE和ASLR保护主要用于防护**ROP**的攻击。PIE保护会使程序地址空间分布随机化（随机化代码段、数据段、bss段的基地址），即程序起始地址位置不确定。如果没开启PIE保护，则程序的起始地址是确定的（0x400000或0x804000）。ASLR保护会使程序加载地址随机化（随机化栈的基地址、libc的基地址、mmap的基地址、堆的基地址），增加找到攻击函数（如libc中的system）的难度。

## FORTIFY

FORTIFY保护主要用于防护**格式化字符串**的攻击。包含%n的格式化字符串不能位于程序内存中的可写地址（防止写入），当使用位置参数时，必须使用范围内的所有位置参数，如果使用%5$x，要先使用1\$、2\$、3\$、4\$（防止泄露）。

## RELRO

RELRO保护主要用于防护对**GOT表**的攻击。设置符号重定向表为只读并在程序启动时就解析并绑定所有动态符号，从而减少对GOT表的攻击。